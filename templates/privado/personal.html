{% extends 'privado/base.html' %}

{% block title %}GestiÃ³n de Choferes{% endblock %}

{% block content %}

<h1>ğŸ‘¥ GestiÃ³n de Choferes</h1>

{% with messages = get_flashed_messages(with_categories=true) %}
Â  Â  {% if messages %}
Â  Â  Â  Â  {% for category, message in messages %}
Â  Â  Â  Â  Â  Â  <div class="alert alert-{{ category }}">{{ message }}</div>
Â  Â  Â  Â  {% endfor %}
Â  Â  {% endif %}
{% endwith %}

<section style="display: flex; justify-content: flex-end; margin-bottom: 15px;">
Â  Â  <a href="{{ url_for('panel_personal') }}?nuevo_chofer=true#modal-registro-chofer" class="btn btn-primary">â• Nuevo Chofer</a> 
</section>

<hr>

<section>
Â  Â  <h2>Choferes Gestionables (Ruta ID: {{ id_ruta | default('N/A') }})</h2>
Â  Â  
    {% if id_ruta %}
    <p style="color: green; font-weight: bold;">[INFO] La lista incluye a: 1) Choferes con historial en tu ruta y 2) Choferes nuevos sin asignaciÃ³n (disponibles).</p>
    {% else %}
    <p style="color: orange; font-weight: bold;">[ALERTA] No tienes una ruta activa asignada. Contacta al administrador.</p>
    {% endif %}

Â  Â  <table border="1" width="100%" cellpadding="6">
Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  <th>ID Empleado</th>
Â  Â  Â  Â  Â  Â  <th>Nombre Completo</th>
Â  Â  Â  Â  Â  Â  <th>DNI</th>
Â  Â  Â  Â  Â  Â  <th>Licencia</th>
Â  Â  Â  Â  Â  Â  <th>Experiencia</th>
Â  Â  Â  Â  Â  Â  <th>Acciones</th> 
Â  Â  Â  Â  </tr>

Â  Â  Â  Â  {% for c in choferes_existentes %}
Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  <td>{{ c.id_empleado }}</td>
Â  Â  Â  Â  Â  Â  <td>{{ c.nombre }} {{ c.apellido }}</td>
Â  Â  Â  Â  Â  Â  <td>{{ c.dni }}</td>
Â  Â  Â  Â  Â  Â  <td>{{ c.nro_licencia }} ({{ c.tipo_licencia }})</td>
Â  Â  Â  Â  Â  Â  <td>{{ c.aÃ±os_experiencia }} aÃ±os</td>
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  <td>
Â  Â  Â  Â  Â  Â  Â  Â  <a href="#" class="btn-sm">âœï¸ Editar</a>
Â  Â  Â  Â  Â  Â  Â  Â  <a href="#" class="btn-sm btn-warning">ğŸ—‘ï¸ Eliminar</a>
Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  </tr>
Â  Â  Â  Â  {% else %}
Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  <td colspan="6" align="center">No hay choferes gestionables para tu ruta actualmente.</td>
Â  Â  Â  Â  </tr>
Â  Â  Â  Â  {% endfor %}
Â  Â  </table>
</section>

<hr style="margin-top: 40px; border-color: #333;">


{% if 'nuevo_chofer' in request.args %}
<div id="modal-registro-chofer" style="border: 2px solid green; padding: 20px; margin-top: 20px; margin-bottom: 20px;">
    <h2>â• Registrar Nuevo Chofer</h2>
    <form method="post" action="{{ url_for('registrar_personal') }}">
        <input type="hidden" name="tipo_registro" value="chofer">
        
        <h3>Datos Personales</h3>
        <label>Nombre</label>
        <input type="text" name="nombre" required>
        
        <label>Apellido</label>
        <input type="text" name="apellido" required>
        
        <label>DNI</label>
        <input type="text" name="dni" required>

        <label>TelÃ©fono (Opcional)</label>
        <input type="text" name="telefono">

        <hr>
        <h3>Datos Laborales</h3>
        
        <label>Sueldo Base</label>
        <input type="number" name="sueldo" step="0.01" min="0" required>
        
        <label>Fecha de Ingreso</label>
        <input type="date" name="fecha_ingreso" required>

        <hr>
        <h3>Datos de ConducciÃ³n</h3>
        
        <label>NÃºmero de Licencia</label>
        <input type="text" name="nro_licencia" required>
        
        <label>AÃ±os de Experiencia</label>
        <input type="number" name="anos_experiencia" min="0" required>
        
        <label>Tipo de Licencia</label>
        <select name="id_tipo_licencia" required>
            <option value="" disabled selected>Seleccione CategorÃ­a</option>
            {% for tl in tipos_licencia %}
                <option value="{{ tl.id_tipo_licencia }}">{{ tl.categoria }}</option>
            {% endfor %}
        </select>
        
        <label>Historial de Infracciones (Opcional)</label>
        <textarea name="historial_infracciones"></textarea>

        <button type="submit">Guardar Chofer</button>
        <a href="{{ url_for('panel_personal') }}" class="btn-sm">Cancelar</a> 
    </form>
</div>
{% endif %}

{% endblock %}